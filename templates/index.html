<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Page metadata (not directly visible) -->
  <meta charset="UTF-8">
  <title>YouTube Chapter Splitter</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!--
    • Bootstrap for responsive layout
    • Inter font for modern typography
  -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    rel="stylesheet">
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap"
    rel="stylesheet">

  <style>
    /* Apply chosen font and background gradient */
    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(to right, #f4f7fa, #eef1f5);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* Navbar brand styling */
    .navbar-brand {
      font-weight: 600;
      font-size: 1.4rem;
    }

    /* Card containing form & progress */
    .card {
      border: none;
      border-radius: 16px;
      padding: 2rem;
      background: #ffffffcc;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
    }

    /* Primary button styling */
    .btn-primary {
      background-color: #4f46e5;
      border-color: #4f46e5;
      border-radius: 12px;
      font-weight: 600;
    }

    /* Input field styling */
    .form-control {
      border-radius: 12px;
      padding: 0.75rem 1rem;
      font-size: 1rem;
    }

    /* Thicker, rounded progress bar */
    .progress {
      height: 20px;
      border-radius: 10px;
    }
    .progress-bar {
      background-color: #16a34a;
      font-weight: 600;
    }

    /* Rounded message boxes */
    .alert {
      border-radius: 12px;
    }

    /* Constrain max width */
    .container {
      max-width: 600px;
    }

    /* Footer styling */
    footer {
      margin-top: auto;
      text-align: center;
      font-size: 0.9rem;
      color: #777;
      padding: 1rem;
    }
  </style>
</head>

<body class="d-flex flex-column">
  <!-- Top navigation bar -->
  <nav class="navbar navbar-dark bg-dark mb-4">
    <div class="container-fluid">
      <span class="navbar-brand">Split YouTube Video Chapters Into MP3s</span>
    </div>
  </nav>

  <!-- Main content area -->
  <div class="container mb-5">
    <div class="card shadow-sm">
      <div class="card-body">

        <!-- Tool explanation -->
        <div class="alert alert-info">
          This tool lets you download audio from a YouTube video and automatically splits it into separate MP3 files based on chapter timestamps in the video. If the video has no chapters, it saves the full audio as a single MP3 file.
        </div>

        <h5 class="card-title mb-3">Enter a YouTube URL</h5>

        <!-- URL input form -->
        <form id="split-form">
          <input
            type="url"
            class="form-control mb-3"
            id="youtube_url"
            placeholder="https://www.youtube.com/watch?v=VIDEO_ID"
            pattern="https?://(www\.)?(youtube\.com/watch\?v=|youtu\.be/)[A-Za-z0-9_\-]{11}.*"
            title="Must be a YouTube video URL"
            required>
          <button id="download-btn" class="btn btn-primary w-100">
            Download &amp; Split
          </button>
        </form>

        <!-- Disclaimer -->
        <div class="alert alert-secondary mt-4">
          <strong>Disclaimer:</strong><br>
          This is a third-party application and is not affiliated with, endorsed by, or associated with YouTube.
        </div>

        <!-- Progress display (hidden until started) -->
        <div id="progress-section" class="mt-4" style="display:none;">
          <p id="status-text">Starting…</p>
          <div class="progress">
            <div
              id="progress-bar"
              class="progress-bar"
              role="progressbar"
              style="width:0%"
              aria-valuemin="0"
              aria-valuemax="100">
              0%
            </div>
          </div>
        </div>

        <!-- Place to show result or error messages -->
        <div id="message-section" class="mt-4"></div>
      </div>
    </div>
  </div>

  <!-- Footer text -->
  <footer>
    Made with ❤️ for modern web in 2025
  </footer>

  <!-- Bootstrap JS for interactive bits -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Grab the key page elements once
    const form  = document.getElementById('split-form');
    const btn   = document.getElementById('download-btn');
    const bar   = document.getElementById('progress-bar');
    const prog  = document.getElementById('progress-section');
    const stat  = document.getElementById('status-text');
    const msg   = document.getElementById('message-section');

    // When the user submits the form...
    form.addEventListener('submit', async e => {
      e.preventDefault();         // Don’t reload page
      msg.innerHTML = '';         // Clear old messages
      const url = document.getElementById('youtube_url').value;
      btn.disabled = true;        // Prevent double‑click
      btn.innerText = 'Starting…';
      prog.style.display = 'block'; // Show progress area

      // 1) Ask server to start the job
      let res = await fetch('/start', {
        method: 'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({ youtube_url: url })
      });
      if (!res.ok) {
        const err = await res.json();
        return showError(err.error);
      }
      const { task_id } = await res.json();

      // 2) Poll progress until done
      const poll = async () => {
        let p = await fetch(`/progress/${task_id}`);
        let d = await p.json();
        if (d.error) return showError(d.error);

        // Update the bar and status text
        bar.style.width = d.percent + '%';
        bar.innerText  = d.percent + '%';
        stat.innerText = d.status.charAt(0).toUpperCase() + d.status.slice(1);

        if (d.status === 'done') {
          // Force full bar to 100% so it never gets stuck
          bar.style.width = '100%';
          bar.innerText  = '100%';
          fetchResult(task_id);
        } else if (d.status === 'error') {
          showError('An error occurred');
        } else {
          setTimeout(poll, 800); // Check again soon
        }
      };
      poll();
    });

    // After “done”, fetch final result & show download links
    async function fetchResult(id) {
      let r = await fetch(`/result/${id}`);
      let d = await r.json();
      if (d.error) return showError(d.error);
      const rlt = d.result;

      // Build a success message with file links
      msg.innerHTML = `
        <div class="alert alert-success">
          <h5>✅ Download complete!</h5>
          <p><strong>Video:</strong> ${rlt.video_title}</p>
          <p><strong>Saved to:</strong> ${rlt.path}</p>
          <p><strong>Time:</strong> ${rlt.total_time} s</p>
          <p><strong>Space:</strong> ${rlt.total_space} MB</p>
          <h6>Files:</h6>
          <ul>
            ${rlt.files.map(f =>
              `<li><a href="/download/${encodeURIComponent(rlt.path + '/' + f)}">${f}</a></li>`
            ).join('')}
          </ul>
        </div>`;

      // If no chapters were found, warn the user
      if (rlt.no_chapters) {
        msg.innerHTML += `
          <div class="alert alert-warning mt-3">
            ⚠️ No chapters found — full audio saved instead.
          </div>`;
      }

      // Re‑enable button for new jobs
      btn.disabled = false;
      btn.innerText = 'Download & Split';
    }

    // Show an error message and reset the UI
    function showError(txt) {
      prog.style.display = 'none';
      msg.innerHTML = `<div class="alert alert-danger">❌ ${txt}</div>`;
      btn.disabled = false;
      btn.innerText = 'Download & Split';
    }
  </script>
</body>
</html>
